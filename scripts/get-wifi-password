#!/usr/bin/env bash
set -euo pipefail

wifiname="${1:-}"

if [[ -z "$wifiname" ]]; then
    echo "Usage: $(basename "$0") <network-name>" >&2
    echo "" >&2
    echo "Available networks:" >&2
    security dump-keychain 2>/dev/null | \
        rg '"desc"<blob>="AirPort network password"' -B 5 | \
        rg '"acct"<blob>' | \
        cut -d'"' -f4 | \
        sort -u
    exit 1
fi

security find-generic-password -D "AirPort network password" -a "$wifiname" -g 2>&1 | grep "password:"
